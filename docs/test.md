# sshとは
サーバーマシンに接続するためのアプリケーションのようなもの．**s**ecure **sh**ell．コマンドで操作するやつ．

使用方法は全てのOSで共通です．コマンドを実行するためにはコンソールを立ち上げる必要があります．立ち上げ方は以下．

- winの場合）`powershell`を呼び出す（see -> [[test2]]）
- macの場合）terminalを開く．
- Ubuntuの場合）terminalを開く．　

[[日本語ページ]]

# 接続の仕方

```
ssh <USER_NAME>@<IP_ADDRESS>

<具体例>
ssh xxx@192.168.x.x
```

ここで，`<USER_NAME>`はサーバーに登録されているアカウントのユーザIDである．クライアントのマシンの中のアカウント名ではない．また`<IP_ADDRESS>`サーバーのIPアドレスである．

セキュリティ上，sshのポートを変更することは多い．その場合は以下のようにアクセスする．

```
ssh -p <PORT> <USER_NAME>@<IP_ADDRESS>

<具体例>
ssh xxx@192.168.x.x
```

# 秘密鍵と公開鍵
セキュリティのため，鍵交換方式で接続を強制することもあります．言い換えれば，セキュリティが不要な場合は鍵交換方式で接続しなくてもよいように設定することが多い．具体的には，研究室内に配置してあるGPUクラスターに研究室内のPCからアクセスするときには，鍵交換方式で接続する設定にはしていない．一方DMZに配置されている研究室のウェブサーバーは，鍵交換方式で接続するように設定されている．

とても重要なこととして，公開鍵は第三者に漏洩しても問題がないが，**秘密鍵が第三者に漏洩するとセキュリティ上の大きな問題になる**．秘密鍵の取り扱いには細心を注意を払うこと．

秘密鍵と公開鍵についての詳細は各自検索してください．以下のURLが参考になるかも？
- [google](https://www.google.co.jp/)
- [yahoo](https://www.yahoo.co.jp/)

## 鍵の生成
鍵交換方式で接続する場合，サーバーには公開鍵を登録し，クライアントは秘密鍵を所有している必要があります．二つの鍵は，以下のコマンドにより生成できます．

```
ssh-keygen -t rsa
```

実行すると対話的に必要な情報を入力することを求められる．各所で注記を入れていくので，参考にしながら進めていくとよい．ちなみに以下はwinで実行した例であり，winのユーザのアカウント名は`iui`であった．

```
PS C:\Users\iui\.ssh> ssh-keygen -t rsa     <- 鍵生成コマンドの実行
Generating public/private rsa key pair.
Enter passphrase (empty for no passphrase):   <- なにも表示されていないが，ここでパスフレーズを入力している
Enter same passphrase again:   <- 同上
The key fingerprint is:     <- なんか表示されるけどあんま気にしなくていいんじゃん？
The key's randomart image is:     <- なんか表示されるけどあんま気にしなくていいんじゃん？
+---[RSA 2048]----+
|o.*oo..          |
|.O o . .         |
|..O     .        |
|. ++     o       |
|.X *.   S .      |
|X #..            |
|=+o*o            |
|+=+=E            |
|+Bo o.           |
+----[SHA256]-----+
```

このコマンドにより，`C:/Users/xxx`に二つのファイルが生成された．

鍵交換方式で接続するためには，生成した公開鍵をサーバーに登録する必要がある．その手続きはサーバーの管理者が代行する．手続きは以下．
1. クライアント，サーバーの管理者に公開鍵（上の例では`id_rsa.pub`）を渡す
1. サーバーの管理者，`~/.ssh/authorized_keys`に，秘密鍵のファイルのテキストデータを追記する
   - `~/.ssh/authorized_keys`がない場合は作成すること

その後，クライアントは以下のコマンドにより，サーバーへ接続する．

```
ssh -i <SECRET_PATH> <USER_NAME>@<IP_ADDRESS>

<具体例>
ssh -i C:/Users/xxx/.ssh/id_rsa xx@192.168.xx.xx
```

ちなみに，上記例ではわざわざ明示的に秘密鍵のパスを指定したが，sshの鍵のデフォルトの保存場所に鍵が保存されていれば，指定しなくても接続できる．

# 複数の鍵の管理
サーバーAで仕事することもあるし，サーバーBで仕事することもある．そんなケースもあると思う．そんなときのTipsがここに．

1. 鍵を使いまわす
   - あなたは公開鍵と秘密鍵を1ペアだけを持っており，複数のサーバーに公開鍵を登録し，一つの秘密鍵で全てのサーバーにアクセスする．
   - 管理が楽．絶対に秘密鍵を漏洩させないように!!!
1. サーバーごとに秘密鍵を作る
   - あなたはサーバーごとに公開鍵と秘密鍵のペアを用意し，サーバーAには公開鍵Aを，サーバーBには公開鍵Bを登録する．そしてサーバーAには秘密鍵Aを，サーバーBには秘密鍵Bを使用しアクセスする．
   - そういうときもあるよね．その時は`~/.ssh/config`を作るとよい．詳細は調べなさい．
   - [ここ](http://www.ellinikonblue.com/blosxom/UNIX/20150721SSH.html)とかも確認するといいかも


# sshでファイル送る，受け取る

`scp`コマンドを使う．

送る場合
```
# ファイルの場合
# scp -P <ssh_port> -i <secret_path> <file_src> <user>@<local_machine>:<file_dest>


# ディレクトリの場合
# scp -P <ssh_port> -i <secret_path> -rq <dir_src> <user>@<local_machine>:<file_dest>

```

受け取る場合
```
まだ書いてないよ！
```
